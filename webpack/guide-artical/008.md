### 生产环境

本节将要介绍一些关于如何在开发一个app或者站点的生产环境中使用webpack优化体验的方法和方式！

**本节基于[development](https://github.com/woai30231/frontend-build-tools-note/blob/master/webpack/guide-artical/005.md)和[tree shaking](https://github.com/woai30231/frontend-build-tools-note/blob/master/webpack/guide-artical/007.md)两章内容，如果你不清楚相关章节内容，那么请回览一下！**


### 步骤

首先，我们在使用webpack的时候，不用的开发环境所需要做的配置有大不同！在开发环境，我们会更注重编译代码和源代码的映射关系，这样方便调试，以及优化一个本地服务器，并提供相应加载和模块热加载功能。但是在生产环境，我们更注重代码的压缩体积，以及减少代码于源代码的映射，还有减少静态资源的大小从而减少下载响应时间。因为有这样的业务上的不同，所以我们平时更倾向于对于不同的开发环境编写不同的webpack配置文件。

当我们正准备着手为不同的环境编写不同的配置文件的时候，我们发现，其实部分配置信息其实是一样的，可以在不同的开发环境通用，所以我们可以吧这部分配置信息独立出来，然后分别合并到其它对应的配置文件中，这里需要用到一个插件就是webpack-merge，这样，我们就不会在不同配置文件写两份一样的代码了。

首先，安装webpack-merge

```bash
  npm install --save-dev webpack-merge
```
* project

```bash
  webpack-demo
  |- package.json
- |- webpack.config.js
+ |- webpack.common.js
+ |- webpack.dev.js
+ |- webpack.prod.js
  |- /dist
  |- /src
    |- index.js
    |- math.js
  |- /node_modules
```

* webpack.common.js

```js
+ const path = require('path');
+ const CleanWebpackPlugin = require('clean-webpack-plugin');
+ const HtmlWebpackPlugin = require('html-webpack-plugin');
+
+ module.exports = {
+   entry: {
+     app: './src/index.js'
+   },
+   plugins: [
+     new CleanWebpackPlugin(['dist']),
+     new HtmlWebpackPlugin({
+       title: 'Production'
+     })
+   ],
+   output: {
+     filename: '[name].bundle.js',
+     path: path.resolve(__dirname, 'dist')
+   }
+ };
```

* webpack.dev.js

```js
+ const merge = require('webpack-merge');
+ const common = require('./webpack.common.js');
+
+ module.exports = merge(common, {
+   mode: 'development',
+   devtool: 'inline-source-map',
+   devServer: {
+     contentBase: './dist'
+   }
+ });
```

* webpack.prod.js

```js
+ const merge = require('webpack-merge');
+ const common = require('./webpack.common.js');
+
+ module.exports = merge(common, {
+   mode: 'production',
+ });
```
